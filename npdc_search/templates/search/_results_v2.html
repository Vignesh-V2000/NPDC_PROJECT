{% for dataset in page_obj %}
<div class="card mb-3 shadow-sm result-card border-0" style="border-top: 4px solid #0d6efd !important;">
    <div class="card-body">
        <!-- Header: Title and Scientist Count -->
        <div class="d-flex justify-content-between align-items-start mb-2">
            <h5 class="card-title mb-0 fw-bold">
                <a href="{% url 'data_submission:view_submission' dataset.id %}"
                    class="text-decoration-none text-primary search-highlight">
                    {{ dataset.title }}
                </a>
            </h5>
            <span class="badge bg-success rounded-pill"
                title="{{ dataset.scientists.count }} Scientist{{ dataset.scientists.count|pluralize }}">
                <i class="fas fa-users me-1"></i>{{ dataset.scientists.count }}
            </span>
        </div>

        <!-- Abstract -->
        <div class="abstract-container mb-3">
            <p class="card-text text-muted mb-0 abstract-preview search-highlight">
                {{ dataset.abstract|truncatechars:250 }}
            </p>
            {% if dataset.abstract|length > 250 %}
            <div class="abstract-full d-none">
                <p class="card-text text-muted mb-0 search-highlight">{{ dataset.abstract }}</p>
            </div>
            <a href="#" class="small text-primary abstract-toggle text-decoration-none" onclick="this.previousElementSibling.classList.toggle('d-none');
                            this.previousElementSibling.previousElementSibling.classList.toggle('d-none');
                            this.textContent = this.textContent === 'Show more' ? 'Show less' : 'Show more';
                            return false;">Show more</a>
            {% endif %}
        </div>

        <!-- Badges Row -->
        <div class="d-flex flex-wrap gap-2 mb-3">
            <span class="badge bg-primary rounded-pill">
                <i class="fas fa-globe-americas me-1"></i>{{ dataset.get_expedition_type_display }}
            </span>
            <span class="badge bg-secondary rounded-pill" style="background-color: #6c757d !important;">
                <i class="fas fa-folder me-1"></i>{{ dataset.get_category_display }}
            </span>
            <span class="badge bg-info text-dark rounded-pill" style="background-color: #0dcaf0 !important;">
                <i class="fas fa-calendar me-1"></i>{{ dataset.expedition_year }}
            </span>
            <span class="badge bg-light text-dark border rounded-pill">
                <i class="fas fa-tags me-1"></i>{{ dataset.get_iso_topic_display }}
            </span>
        </div>

        <!-- 3-Column Details -->
        <div class="row g-3 text-muted small border-top pt-3">
            <!-- Temporal Coverage -->
            <div class="col-md-4">
                <div class="d-flex">
                    <div class="me-3">
                        <i class="fas fa-clock text-primary fs-5"></i>
                    </div>
                    <div>
                        <div class="fw-bold text-dark mb-1">Temporal Coverage</div>
                        <div>{{ dataset.temporal_start_date|date:"M d, Y" }} — </div>
                        <div>{{ dataset.temporal_end_date|date:"M d, Y" }}</div>
                    </div>
                </div>
            </div>

            <!-- Spatial Extent -->
            <div class="col-md-4">
                <div class="d-flex">
                    <div class="me-3">
                        <i class="fas fa-map-marked-alt text-success fs-5"></i>
                    </div>
                    <div>
                        <div class="fw-bold text-dark mb-1">Spatial Extent</div>
                        <div>{{ dataset.south_latitude }}°S to {{ dataset.north_latitude }}°N</div>
                        <div>{{ dataset.west_longitude }}°W to {{ dataset.east_longitude }}°E</div>
                    </div>
                </div>
            </div>

            <!-- Status -->
            <div class="col-md-4">
                <div class="d-flex">
                    <div class="me-3">
                        <i class="fas fa-database text-secondary fs-5"></i>
                    </div>
                    <div>
                        <div class="fw-bold text-dark mb-1">Status</div>
                        <div>{{ dataset.get_status_display }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-3 pt-3 border-top d-flex align-items-center text-muted small">
            <div class="d-flex align-items-center me-4">
                <i class="fas fa-user me-2"></i>
                <span class="fw-semibold">{{ dataset.submitter.get_full_name|default:dataset.submitter.username
                    }}</span>
            </div>
            <div class="d-flex align-items-center">
                <i class="fas fa-calendar-plus me-2"></i>
                <span>Submitted {{ dataset.submission_date|date:"M d, Y" }}</span>
            </div>
        </div>
    </div>
</div>
{% empty %}
<div class="card border-0 shadow-sm">
    <div class="card-body text-center py-5">
        <i class="fas fa-search fa-4x text-muted mb-3"></i>
        <h4 class="text-muted">No datasets found</h4>
        <p class="text-muted mb-3">Try adjusting your search criteria or clearing filters</p>
        <a href="{% url 'search:search' %}" class="btn btn-primary">
            <i class="fas fa-redo me-1"></i>Reset Search
        </a>
    </div>
</div>
{% endfor %}