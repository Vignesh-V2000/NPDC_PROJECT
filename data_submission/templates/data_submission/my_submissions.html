{% extends "base.html" %}

{% block title %}My Submissions - NPDC{% endblock %}

{% block content %}
<style>
    .container-fluid {
        color: #333333;
    }
    
    .container-fluid h2,
    .container-fluid h3,
    .container-fluid h4,
    .container-fluid h5 {
        color: var(--primary-blue) !important;
    }
    
    .container-fluid p,
    .container-fluid span,
    .container-fluid label {
        color: #333333;
    }
</style>
<div class="container-fluid py-4">

    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">My Submissions</h2>
        <a href="{% url 'data_submission:instructions' %}" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>New Submission
        </a>
    </div>

    <!-- Saved and Incomplete Metadata -->
    <div class="mb-5">
        <div class="table-responsive">
            <table class="table table-bordered align-middle">
                <thead>
                    <tr class="table-secondary">
                        <th colspan="5" class="fw-bold">Saved and Incomplete Metadata</th>
                    </tr>
                    <tr class="table-light fw-bold">
                        <th style="width: 5%;" class="text-center">Sl No.</th>
                        <th style="width: 50%;">Title</th>
                        <th style="width: 15%;" class="text-center">Submitted On</th>
                        <th style="width: 15%;" class="text-center">Updated On</th>
                        <th style="width: 15%;" class="text-center">Dataset</th>
                    </tr>
                </thead>
                <tbody>
                    {% for submission in incomplete_submissions %}
                    <tr>
                        <td class="text-center">{{ forloop.counter }}</td>
                        <td>{{ submission.title }}</td>
                        <td class="text-center">
                            <div>{{ submission.submission_date|date:"d-m-Y" }}</div>
                            <a href="{% url 'data_submission:submit_dataset' %}?edit={{ submission.id }}"
                                class="text-decoration-none small">Edit</a>
                        </td>
                        <td class="text-center">
                            {% if submission.last_updated %}
                            <div>{{ submission.last_updated|date:"d-m-Y" }}</div>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <a href="{% url 'data_submission:upload_dataset_files' submission.id %}"
                                class="btn btn-light border btn-sm">Upload</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-3">No incomplete submissions found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Recently Submitted and Published Metadata -->
    <div class="mb-5">
        <div class="table-responsive">
            <table class="table table-bordered align-middle">
                <thead>
                    <tr class="table-secondary">
                        <th colspan="5" class="fw-bold">Recently Submitted and Published Metadata</th>
                    </tr>
                    <tr class="table-light fw-bold">
                        <th style="width: 5%;" class="text-center">Sl No.</th>
                        <th style="width: 50%;">Title</th>
                        <th style="width: 15%;" class="text-center">Submitted On</th>
                        <th style="width: 15%;" class="text-center">Updated On</th>
                        <th style="width: 15%;" class="text-center">Dataset</th>
                    </tr>
                </thead>
                <tbody>
                    {% for submission in submitted_published_submissions %}
                    <tr>
                        <td class="text-center">{{ forloop.counter }}</td>
                        <td>{{ submission.title }}</td>
                        <td class="text-center">
                            <div>{{ submission.submission_date|date:"d-m-Y" }}</div>
                            <a href="{% url 'data_submission:view_submission' submission.id %}"
                                class="text-decoration-none small">View</a>
                        </td>
                        <td class="text-center">
                            {% if submission.can_be_updated %}
                            <a href="{% url 'data_submission:submit_dataset' %}?edit={{ submission.id }}"
                                class="text-decoration-none small">Update</a>
                            {% endif %}

                            {% if submission.was_updated %}
                            <div class="text-muted small">{{ submission.last_updated|date:"d-m-Y" }}</div>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <a href="{% url 'data_submission:upload_dataset_files' submission.id %}"
                                class="btn btn-light border btn-sm">Upload</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-3">No submitted or published metadata found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

<style>
    .table-secondary {
        background-color: #d1d5db !important;
        /* Matches the gray header in screenshot */
    }

    .table th,
    .table td {
        vertical-align: middle;
    }

    /* Ensure the Upload button looks cleaner */
    .btn-light.border {
        background-color: #f8f9fa;
        border-color: #dee2e6;
        color: #212529;
    }

    .btn-light.border:hover {
        background-color: #e2e6ea;
        border-color: #dae0e5;
    }

    a.small {
        font-size: 0.85rem;
        display: block;
        /* ensure it sits on its own line */
        margin-top: 2px;
    }
</style>
{% endblock %}